<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no">
    <title>لوحة التحكم - نظام الشكاوى الموحد</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Cairo',sans-serif;-webkit-tap-highlight-color:transparent}
        html{font-size:16px;scroll-behavior:smooth}
        body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);color:#333;line-height:1.6;min-height:100vh;overflow-x:hidden;padding-bottom:80px}
        .container{max-width:1400px;margin:0 auto;padding:15px}
        .login-container{display:flex;justify-content:center;align-items:center;min-height:100vh;padding:20px;background:linear-gradient(135deg,#1a5fb4 0%,#2d8fd5 100%)}
        .login-box{background:#fff;border-radius:20px;padding:30px 25px;width:100%;max-width:400px;box-shadow:0 20px 40px rgba(0,0,0,.2);text-align:center;animation:slideUp .5s ease}
        @keyframes slideUp{from{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}
        .login-logo{font-size:3rem;color:#1a5fb4;margin-bottom:15px}
        .login-title{font-size:1.6rem;color:#2c3e50;margin-bottom:25px;font-weight:700}
        .login-form .form-group{margin-bottom:20px;text-align:right}
        .login-form .form-label{display:block;margin-bottom:8px;font-weight:600;color:#2c3e50;font-size:1rem}
        .login-form .form-control{width:100%;padding:16px 15px;border:2px solid #ddd;border-radius:10px;font-size:16px;transition:all .3s;background:#f8f9fa}
        .login-form .form-control:focus{border-color:#1a5fb4;outline:none;box-shadow:0 0 0 3px rgba(26,95,180,.1);background:#fff}
        .login-btn{width:100%;padding:18px;background:linear-gradient(to right,#1a5fb4,#2d8fd5);color:#fff;border:none;border-radius:10px;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:10px}
        .login-btn:hover{background:linear-gradient(to right,#155093,#1a5fb4);transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.15)}
        .login-error{color:#e74c3c;margin-top:15px;padding:15px;background:#fde8e8;border-radius:10px;display:none;font-size:.95rem}
        header{background:linear-gradient(135deg,#1a5fb4 0%,#2d8fd5 100%);color:#fff;padding:20px 0 25px;text-align:center;border-radius:0 0 25px 25px;box-shadow:0 8px 25px rgba(0,0,0,.15);margin-bottom:20px;position:relative;overflow:hidden}
        header::before{content:'';position:absolute;top:0;left:0;right:0;height:5px;background:linear-gradient(90deg,#ff7e5f,#feb47b,#86a8e7,#91eae4);background-size:400% 400%;animation:gradientShift 8s ease infinite}
        @keyframes gradientShift{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
        .logo{font-size:1.8rem;margin-bottom:8px;text-shadow:2px 2px 4px rgba(0,0,0,.2);padding:0 15px;line-height:1.4}
        .subtitle{font-size:1rem;opacity:.9;max-width:600px;margin:0 auto;padding:0 15px;line-height:1.5}
        .admin-bar{background:linear-gradient(135deg,#2c3e50 0%,#4a6572 100%);color:#fff;padding:15px;border-radius:15px;margin-bottom:20px;box-shadow:0 5px 15px rgba(0,0,0,.1);display:flex;flex-direction:column;gap:15px}
        .admin-info{display:flex;align-items:center;gap:12px}
        .admin-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,#3498db,#2c3e50);display:flex;align-items:center;justify-content:center;font-size:1.4rem;box-shadow:0 4px 10px rgba(0,0,0,.2);flex-shrink:0}
        .admin-text{flex-grow:1;overflow:hidden}
        .admin-text h3{margin-bottom:5px;font-size:1.1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .admin-text p{opacity:.9;font-size:.85rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .admin-stats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .stat-box{background:rgba(255,255,255,.15);padding:12px 8px;border-radius:10px;text-align:center;backdrop-filter:blur(10px)}
        .stat-value{font-size:1.5rem;font-weight:700;margin-bottom:5px}
        .stat-label{font-size:.8rem;opacity:.9;line-height:1.3}
        .logout-btn{background:#e74c3c;color:#fff;border:none;padding:12px 20px;border-radius:10px;cursor:pointer;font-weight:600;transition:all .3s;display:flex;align-items:center;justify-content:center;gap:8px;font-size:1rem;width:100%}
        .logout-btn:hover{background:#c0392b;transform:translateY(-2px)}
        .dashboard-grid{display:flex;flex-direction:column;gap:20px}
        .sidebar-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:999;animation:fadeIn .3s ease}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .sidebar{background:#fff;border-radius:20px 0 0 20px;padding:25px 20px;box-shadow:0 0 30px rgba(0,0,0,.3);height:100vh;width:280px;position:fixed;top:0;right:-300px;z-index:1000;transition:right .3s ease;overflow-y:auto}
        .sidebar.active{right:0}
        .sidebar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:2px solid #f0f0f0}
        .sidebar-title{font-size:1.3rem;color:#2c3e50;font-weight:700}
        .close-sidebar{background:none;border:none;font-size:1.5rem;color:#666;cursor:pointer;padding:5px}
        .sidebar-menu{list-style:none}
        .menu-item{padding:16px 15px;margin-bottom:8px;border-radius:12px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;gap:12px;color:#555;font-size:1rem}
        .menu-item:hover{background:#f8f9fa;transform:translateX(-5px)}
        .menu-item.active{background:linear-gradient(to right,#1a5fb4,#2d8fd5);color:#fff;box-shadow:0 5px 15px rgba(26,95,180,.3)}
        .menu-icon{font-size:1.2rem;width:24px;text-align:center}
        .badge{background:#e74c3c;color:#fff;border-radius:10px;padding:4px 10px;font-size:.8rem;margin-right:auto;display:none}
        .main-content{background:#fff;border-radius:20px;padding:20px;box-shadow:0 5px 20px rgba(0,0,0,.08);margin-bottom:80px}
        .footer{text-align:center;padding:20px 15px;color:#666;font-size:.9rem;margin-top:30px;background:#fff;border-radius:15px;box-shadow:0 5px 15px rgba(0,0,0,.05);line-height:1.7}
        .footer a{color:#1a5fb4;text-decoration:none;font-weight:700;display:inline-flex;align-items:center;gap:6px}
        .footer a:hover{color:#155093}
        .admin-only{display:none}
        .loading-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,.9);display:none;justify-content:center;align-items:center;z-index:9999}
        .loading-spinner{width:60px;height:60px;border:5px solid #f3f3f3;border-top:5px solid #1a5fb4;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
        .message{position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:12px;z-index:10000;box-shadow:0 10px 30px rgba(0,0,0,.2);max-width:90%;animation:slideIn .3s ease;font-size:.95rem;line-height:1.5;background:#d4edda;color:#155724}
        .message.error{background:#f8d7da;color:#721c24}
        @keyframes slideIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
        .complaint-details-modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.9);display:none;justify-content:center;align-items:center;z-index:1100;padding:15px}
        .modal-content{background:#fff;border-radius:20px;width:100%;max-width:500px;max-height:85vh;overflow-y:auto;position:relative;animation:modalSlideUp .3s ease}
        @keyframes modalSlideUp{from{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}
        .modal-header{background:linear-gradient(135deg,#1a5fb4 0%,#2d8fd5 100%);color:#fff;padding:20px;border-radius:20px 20px 0 0;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:1}
        .modal-title{font-size:1.4rem;font-weight:700}
        .close-modal{background:none;border:none;color:#fff;font-size:2rem;cursor:pointer;line-height:1;padding:5px}
        .modal-body{padding:20px}
        .details-grid{display:grid;grid-template-columns:1fr;gap:15px;margin-bottom:20px}
        .detail-item{padding:15px;border-bottom:1px solid #eee;background:#f8f9fa;border-radius:10px}
        .detail-label{font-weight:700;color:#1a5fb4;margin-bottom:8px;font-size:.95rem}
        .action-btn{padding:8px 12px;border:none;border-radius:8px;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;gap:5px;transition:all .2s ease;min-width:70px}
        .btn-view{background:#3498db;color:#fff}
        .btn-secondary{background:#6c757d;color:#fff}
        @media(min-width:769px){.dashboard-grid{display:grid;grid-template-columns:280px 1fr}.sidebar{position:static;width:100%;height:auto;right:0;box-shadow:none;border-radius:15px}.sidebar-overlay{display:none !important}.close-sidebar{display:none}}
    </style>
</head>
<body>
    <!-- شاشة تسجيل الدخول -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-user-shield"></i>
            </div>
            <h2 class="login-title">تسجيل دخول المسؤول</h2>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-control" id="username" placeholder="أدخل اسم المستخدم" required>
                </div>
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-control" id="password" placeholder="أدخل كلمة المرور" required>
                </div>
                <div class="login-error" id="loginError">
                    اسم المستخدم أو كلمة المرور غير صحيحة
                </div>
                <button type="submit" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    تسجيل الدخول
                </button>
            </form>
        </div>
    </div>

    <!-- لوحة التحكم -->
    <div id="dashboardScreen" style="display:none;">
        <header>
            <div class="container">
                <h1 class="logo">لوحة التحكم - نظام الشكاوى الموحد</h1>
                <p class="subtitle">إدارة الشكاوى والطلبات المقدمة من المواطنين</p>
            </div>
        </header>

        <div class="container">
            <div class="admin-bar">
                <div class="admin-info">
                    <div class="admin-avatar">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="admin-text">
                        <h3 id="adminWelcome">مرحباً، المسؤول</h3>
                        <p id="adminLastLogin">آخر دخول: -</p>
                    </div>
                </div>

                <div class="admin-stats">
                    <div class="stat-box">
                        <div class="stat-value" id="totalComplaints">0</div>
                        <div class="stat-label">إجمالي الشكاوى</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="newComplaints">0</div>
                        <div class="stat-label">شكاوى جديدة</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="resolvedComplaints">0</div>
                        <div class="stat-label">تم حلها</div>
                    </div>
                </div>

                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    تسجيل الخروج
                </button>
            </div>

            <div class="dashboard-grid">
                <!-- سايدبار -->
                <div class="sidebar-overlay" id="sidebarOverlay"></div>
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <h3 class="sidebar-title">القائمة الرئيسية</h3>
                        <button class="close-sidebar" id="closeSidebar">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <ul class="sidebar-menu">
                        <li class="menu-item active" data-section="dashboard">
                            <i class="fas fa-tachometer-alt menu-icon"></i>
                            <span>لوحة التحكم</span>
                        </li>
                        <li class="menu-item" data-section="complaints">
                            <i class="fas fa-file-alt menu-icon"></i>
                            <span>إدارة الشكاوى</span>
                            <span class="badge" id="complaintsBadge">0</span>
                        </li>
                        <li class="menu-item admin-only" data-section="users">
                            <i class="fas fa-users menu-icon"></i>
                            <span>المستخدمين</span>
                        </li>
                        <li class="menu-item admin-only" data-section="settings">
                            <i class="fas fa-cog menu-icon"></i>
                            <span>الإعدادات</span>
                        </li>
                    </ul>
                </div>

                <!-- المحتوى الرئيسي -->
                <div class="main-content">
                    <div id="dashboardSection" class="content-section">
                        <p>لوحة التحكم الرئيسية (ضع هنا كروت الإحصائيات والجداول المختصرة كما في كودك الأصلي).</p>
                    </div>

                    <div id="complaintsSection" class="content-section" style="display:none;">
                        <table style="width:100%;border-collapse:collapse;">
                            <thead>
                                <tr>
                                    <th>رقم الشكوى</th>
                                    <th>الاسم</th>
                                    <th>القسم</th>
                                    <th>الأولوية</th>
                                    <th>الحالة</th>
                                    <th>إجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="complaintsTable"></tbody>
                        </table>
                    </div>

                    <div id="usersSection" class="content-section" style="display:none;">
                        <p>قسم إدارة المستخدمين (يمكنك إكماله لاحقًا).</p>
                    </div>

                    <div id="settingsSection" class="content-section" style="display:none;">
                        <p>إعدادات عامة للنظام.</p>
                    </div>
                </div>
            </div>

            <div class="footer">
                <p>© 2026 نظام الشكاوى الموحد - لوحة التحكم الإدارية</p>
                <p>جميع الحقوق محفوظة - الإصدار 2.1.0</p>
                <p>
                    تم برمجة الموقع من
                    <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" rel="noopener">
                        المهندس محمد حماد
                        <i class="fab fa-facebook"></i>
                    </a>
                </p>
            </div>
        </div>

        <!-- نافذة تفاصيل الشكوى -->
        <div class="complaint-details-modal" id="complaintDetailsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">تفاصيل الشكوى</h3>
                    <button class="close-modal" id="closeModal">&times;</button>
                </div>
                <div class="modal-body" id="modalBody"></div>
            </div>
        </div>

        <!-- شريط التحميل -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBIIStbiZD0ZJ6su7C1bwZlBvqx-PP-t58",
            authDomain: "shakawa-e0a3c.firebaseapp.com",
            databaseURL: "https://shakawa-e0a3c-default-rtdb.firebaseio.com",
            projectId: "shakawa-e0a3c",
            storageBucket: "shakawa-e0a3c.firebasestorage.app",
            messagingSenderId: "111620348664",
            appId: "1:111620348664:web:670fdf5caed46eb691b90d",
            measurementId: "G-SGNTJZDQ1L"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let isLoggedIn = false;
        let currentUser = null;
        let currentSection = 'dashboard';
        let allComplaints = [];
        let filteredComplaints = [];
        let currentPage = 1;
        let itemsPerPage = 10;

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        function initApp() {
            checkLoginStatus();
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('closeSidebar').addEventListener('click', closeSidebar);
            document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar);
            document.getElementById('closeModal').addEventListener('click', closeModal);

            document.querySelectorAll('.menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (item.classList.contains('admin-only') && !(currentUser && currentUser.role === 'admin')) {
                        showMessage('يجب تسجيل الدخول كمسؤول للوصول إلى هذا القسم', 'error');
                        return;
                    }
                    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    showSection(item.getAttribute('data-section'));
                    closeSidebar();
                });
            });

            loadComplaints();
        }

        // تسجيل الدخول ثابت admin / 742018
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginError = document.getElementById('loginError');

            if (username === 'admin' && password === '742018') {
                const userData = {
                    username: 'admin',
                    name: 'المدير العام',
                    role: 'admin',
                    phone: ''
                };
                loginError.style.display = 'none';
                loginSuccess(userData);
            } else {
                loginError.style.display = 'block';
            }
        }

        function loginSuccess(userData) {
            isLoggedIn = true;
            currentUser = {
                username: userData.username,
                name: userData.name,
                role: userData.role || 'user',
                phone: userData.phone || '',
                loginTime: new Date().toISOString()
            };
            localStorage.setItem('adminLoggedIn', 'true');
            localStorage.setItem('adminUser', JSON.stringify(currentUser));
            showDashboard();
            showMessage(`مرحباً ${currentUser.name}! تم تسجيل الدخول بنجاح`, 'success');
        }

        function handleLogout() {
            if (!confirm('هل تريد تسجيل الخروج من لوحة التحكم؟')) return;
            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminUser');
            showLogin();
        }

        function checkLoginStatus() {
            const savedLogin = localStorage.getItem('adminLoggedIn');
            const savedUser = localStorage.getItem('adminUser');
            if (savedLogin === 'true' && savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    isLoggedIn = true;
                    showDashboard();
                } catch {
                    localStorage.clear();
                    showLogin();
                }
            } else {
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('dashboardScreen').style.display = 'none';
        }

        function showDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboardScreen').style.display = 'block';
            updateAdminWelcome();
            updateSidebarPermissions();
            showSection('dashboard');
        }

        function updateAdminWelcome() {
            if (!currentUser) return;
            document.getElementById('adminWelcome').textContent = `مرحباً، ${currentUser.name}`;
            if (currentUser.loginTime) {
                const d = new Date(currentUser.loginTime);
                document.getElementById('adminLastLogin').textContent =
                    'آخر دخول: ' + d.toLocaleString('ar-EG');
            }
        }

        function updateSidebarPermissions() {
            const adminOnly = document.querySelectorAll('.admin-only');
            if (currentUser && currentUser.role === 'admin') {
                adminOnly.forEach(el => el.style.display = 'flex');
            } else {
                adminOnly.forEach(el => el.style.display = 'none');
            }
        }

        async function loadComplaints() {
            showLoading();
            try {
                const snap = await database.ref('complaints').get();
                allComplaints = [];
                if (snap.exists()) {
                    snap.forEach(ch => {
                        const c = ch.val();
                        c.key = ch.key;
                        allComplaints.push(c);
                    });
                }
                allComplaints.sort((a,b)=>new Date(b.createdAt)-new Date(a.createdAt));
                updateDashboardStats();
                filteredComplaints = allComplaints.slice();
                displayComplaintsTable();
            } catch(err){
                console.error(err);
                showMessage('حدث خطأ أثناء تحميل الشكاوى','error');
            } finally {
                hideLoading();
            }
        }

        function updateDashboardStats() {
            const total = allComplaints.length;
            const newComplaints = allComplaints.filter(c => c.status === 'جديدة').length;
            const resolvedComplaints = allComplaints.filter(c => c.status === 'مكتملة' || c.status === 'تم الرد').length;
            document.getElementById('totalComplaints').textContent = total;
            document.getElementById('newComplaints').textContent = newComplaints;
            document.getElementById('resolvedComplaints').textContent = resolvedComplaints;
        }

        function displayComplaintsTable() {
            const tbody = document.getElementById('complaintsTable');
            if (!tbody) return;
            if (!filteredComplaints.length) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align:center;padding:40px;color:#666;">لا توجد شكاوى</td></tr>`;
                return;
            }
            const start = (currentPage - 1) * itemsPerPage;
            const currentItems = filteredComplaints.slice(start, start + itemsPerPage);
            let html = '';
            currentItems.forEach(c => {
                html += `
                <tr data-complaint-id="${c.key}">
                    <td><strong>${c.complaintNumber || ''}</strong></td>
                    <td>${c.fullName || ''}</td>
                    <td>${c.department || ''}</td>
                    <td>${c.priority || ''}</td>
                    <td>${c.status || ''}</td>
                    <td>
                        <button class="action-btn btn-view" onclick="viewComplaint('${c.key}')">
                            <i class="fas fa-eye"></i> عرض
                        </button>
                    </td>
                </tr>`;
            });
            tbody.innerHTML = html;
        }

        function viewComplaint(complaintKey) {
            const complaint = allComplaints.find(c => c.key === complaintKey);
            if (!complaint) {
                showMessage('لم يتم العثور على الشكوى','error');
                return;
            }
            const modalBody = document.getElementById('modalBody');
            const createdAt = complaint.createdAt ? new Date(complaint.createdAt).toLocaleString('ar-EG') : '-';
            const updatedAt = complaint.updatedAt ? new Date(complaint.updatedAt).toLocaleString('ar-EG') : createdAt;
            modalBody.innerHTML = `
                <div style="margin-bottom:20px;display:flex;flex-wrap:wrap;gap:10px;">
                    <button class="btn btn-secondary" onclick="closeModal()">
                        <i class="fas fa-times"></i> إغلاق
                    </button>
                </div>
                <div class="details-grid">
                    <div class="detail-item">
                        <div class="detail-label">رقم الشكوى</div>
                        <div><strong>${complaint.complaintNumber || ''}</strong></div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">الاسم</div>
                        <div>${complaint.fullName || ''}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">القسم</div>
                        <div>${complaint.department || ''}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">نوع المشكلة</div>
                        <div>${complaint.priority || ''}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">الحالة</div>
                        <div>${complaint.status || ''}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">تاريخ الإرسال</div>
                        <div>${createdAt}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">آخر تحديث</div>
                        <div>${updatedAt}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">تفاصيل المشكلة</div>
                        <div style="white-space:pre-line;">${complaint.problemDetails || ''}</div>
                    </div>
                </div>`;
            document.getElementById('complaintDetailsModal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('complaintDetailsModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        function showSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(sec => {
                sec.style.display = (sec.id === sectionId + 'Section') ? 'block' : 'none';
            });
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        function showMessage(text, type='success') {
            const old = document.getElementById('globalMessage');
            if (old) old.remove();
            const msg = document.createElement('div');
            msg.id = 'globalMessage';
            msg.className = 'message' + (type === 'error' ? ' error' : '');
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => { msg.remove(); }, 4000);
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('active');
            document.getElementById('sidebarOverlay').style.display = 'none';
        }
    </script>
</body>
</html>
